PBC_PATH=$1
PBC_VCARD_VERSION=$2
PBC_MAX_LIST_COUNT=$3
PBC_LIST_START_OFFSET=$4
PBC_ATTR_MASK=$5
PBC_OUTFILE_PATH=$6

if [ -z "$PBC_PATH" ]
then
   PBC_PULLPB_ERROR=1
fi

if [ -z "$PBC_VCARD_VERSION" ]
then
   PBC_PULLPB_ERROR=1
fi

if [ -z "$PBC_MAX_LIST_COUNT" ]
then
   PBC_PULLPB_ERROR=1
fi

if [ -z "$PBC_LIST_START_OFFSET" ]
then
   PBC_PULLPB_ERROR=1
fi

if [ -z "$PBC_OUTFILE_PATH" ]
then
   PBC_PULLPB_ERROR=1
fi


if [ "$PBC_PULLPB_ERROR" ]
then
   echo "usage: pbc-pullpb <path> <vcardVersion> <maxListCount> <listStartOffset> <attrMask> <outFilepath>"
   echo "
    Valid <path> values are:
        /telecom/pb
        /telecom/ich
        /telecom/och
        /telecom/mch
        /telecom/cch
        /SIM1/telecom/pb
        /SIM1/telecom/ich
        /SIM1/telecom/och
        /SIM1/telecom/mch
        /SIM1/telecom/cch

    Valid <vcardVersion> values are:
        0 : vCard 2.1
        1 : vCard 3.0

    Valid <maxListCount> values are:
        -1 : not set
        0 : for returning list count
        1-65535 : for n entries

    Valid <listStartOffset> values are:
        -1   : not set
         0-n : for starting at offset n 

    Valid <attrMask> value is:
        -1  : not set 
         0  : return all attributes

        OR a 64 bit number, with the following bit(s) set:        
        (BIT ORDER: 64 ..... 0)
        BIT 0 : VERSION:     vCard Version
        BIT 1 : FN:          Formatted Name
        BIT 2 : N:           Structured Presentation of Name 
        BIT 3 : PHOTO:       Associated Image or Photo
        BIT 4 : BDAY:        Birthday
        BIT 5 : ADR:         Delivery Address
        BIT 6 : LABEL:       Delivery
        BIT 7 : TEL:         Telephone Number
        BIT 8 : EMAIL:       Electronic Mail Address
        BIT 9 : MAILER:      Electronic Mail
        BIT 10: TZ:          Timezone
        BIT 11: GEO:         Geographic Position
        BIT 12: TITLE:       Job
        BIT 13: ROLE:        Role within the Organization
        BIT 14: LOGO:        Organization Logo
        BIT 15: AGENT:       vCard of Person Representing
        BIT 16: ORG:         Name of Organization
        BIT 17: NOTE:        Comments
        BIT 18: REV:         Revision
        BIT 19: SOUND:       Pronounciation of Name
        BIT 20: URL:         Uniform Resource Locator
        BIT 21: UID:         Unique ID
        BIT 22: KEY:         Public Encryption Key
        BIT 23: NICKNAME:    Nickname
        BIT 24: CATEGORIES:  Categories
        BIT 25: PROID:       Product ID
        BIT 26: CLASS:       Class Information
        BIT 27: SORT-STRING: String used for sort operations
        BIT 28: X-IRMC-CALL-DATETIME: Timestamp
     BIT 29-38: RESERVED...Set to 0's 
        BIT 39: Proprietary Filter: Indicates use of proprietary filter
     BIT 40-63: Reserved for proprietary filter use
"
   exit 1
fi

PBAP_CLIENT_ACTION="pull_pb --es path $PBC_PATH --es vcardVersion $PBC_VCARD_VERSION --es attrMask $PBC_ATTR_MASK --es maxListCount $PBC_MAX_LIST_COUNT --es listStartOffset $PBC_LIST_START_OFFSET --es outFilepath $PBC_OUTFILE_PATH"

source include.sh