PBC_NAME=$1
PBC_VCARD_VERSION=$2
PBC_ATTR_MASK=$3
PBC_OUTFILE_PATH=$4

if [ -z "$PBC_NAME" ]
then
   PBC_PULL_ERROR=1
fi

if [ -z "$PBC_VCARD_VERSION" ]
then
   PBC_PULL_ERROR=1
fi


if [ -z "$PBC_ATTR_MASK" ]
then
   PBC_PULL_ERROR=1
fi


if [ -z "$PBC_OUTFILE_PATH" ]
then
   PBC_PULL_ERROR=1
fi


if [ "$PBC_PULL_ERROR" ]
then
   echo "usage: pbc-pullventry <name> <vcardVersion> <attrMask> <outFilepath>"
   echo "
 
    Valid <name> value is:
        any entry name relative to the current path
        
    Valid <vcardVersion> values are:
        0 : vCard 2.1
        1 : vCard 3.0

    Valid <attrMask> values are :
       -1 : not set
        0 : return all attributes
       
        OR a 64 bit number, with the following bit(s) set:
        (BIT ORDER: 64 ..... 0)
        BIT 0 : VERSION:     vCard Version
        BIT 1 : FN:          Formatted Name
        BIT 2 : N:           Structured Presentation of Name 
        BIT 3 : PHOTO:       Associated Image or Photo
        BIT 4 : BDAY:        Birthday
        BIT 5 : ADR:         Delivery Address
        BIT 6 : LABEL:       Delivery
        BIT 7 : TEL:         Telephone Number 
        BIT 8 : EMAIL:       Electronic Mail Address
        BIT 9 : MAILER:      Electronic Mail
        BIT 10: TZ:          Timezone
        BIT 11: GEO:         Geographic Position
        BIT 12: TITLE:       Job
        BIT 13: ROLE:        Role within the Organization
        BIT 14: LOGO:        Organization Logo
        BIT 15: AGENT:       vCard of Person Representing
        BIT 16: ORG:         Name of Organization
        BIT 17: NOTE:        Comments
        BIT 18: REV:         Revision
        BIT 19: SOUND:       Pronounciation of Name
        BIT 20: URL:         Uniform Resource Locator
        BIT 21: UID:         Unique ID
        BIT 22: KEY:         Public Encryption Key
        BIT 23: NICKNAME:    Nickname
        BIT 24: CATEGORIES:  Categories
        BIT 25: PROID:       Product ID
        BIT 26: CLASS:       Class Information
        BIT 27: SORT-STRING: String used for sort operations
        BIT 28: X-IRMC-CALL-DATETIME: Timestamp
     BIT 29-38: RESERVED...Set to 0's 
        BIT 39: Proprietary Filter: Indicates use of proprietary filter
     BIT 40-63: Reserved for proprietary filter use
   "

   exit 1
fi

if [ "$PBC_NAME" != "NULL" ]
then
   PBC_NAME_PARAM="--es name $PBC_NAME"
fi


PBAP_CLIENT_ACTION="pull_ventry $PBC_NAME_PARAM --es vcardVersion $PBC_VCARD_VERSION --es attrMask $PBC_ATTR_MASK --es outFilepath $PBC_OUTFILE_PATH"

#echo $PBAP_CLIENT_ACTION

source include.sh